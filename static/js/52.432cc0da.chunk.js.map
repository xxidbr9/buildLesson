{"version":3,"sources":["queries/chat/index.js","pages/Tutor/Profile/AvatarCard.jsx"],"names":["MUTATE_ADD_CHAT_SESSION","gql","QUERY_LIST_CHAT_ROOM","QUERY_LIST_CONVERSATION","MUTATE_ADD_CONVERSATION","ProfileCard","styled","Card","UploadButtons","span","UploadZone","UploadArea","div","ShareButton","ButtonLink","chatClient","newClient","withI18n","data","unauthorizedUser","onShareModal","i18n","onChatWindow","onUploadImage","loading","onSettings","onLocalFile","fetchUser","userData","theTotal","userDetails","teachingDate","localFile","setLocalFile","setShareModal","shareModal","pictureSettings","setPictureSettings","chatWindow","setChatWindow","useState","setConversationList","token","localStorage","getItem","push","useHistory","useMutation","mutateUploadProfilePicture","client","resourceClient","onCompleted","onError","err","renderError","uploadAvatar","variables","receiver_id","Number","pvid","useQuery","receiverId","conversationList","conversations","avatarData","avatar","address","href","target","rel","totalExperience","parseFloat","infoDetail","className","css","src","actual","SERVER_BASE_URL","imagePreview","avatarSrc","length","PLACEHOLDER_OWL_IMAGE","height","title","firstName","initialName","description","id","file","image","crop","zoom","aspect","onCropChange","prev","onCropComplete","area","pixels","onZoomChange","restrictPosition","type","icon","onClick","then","_","size","isAvatar","name","accept","placeholder","onChange","htmlFor","role","aria-label","code","pathname","country","state","style","marginBottom"],"mappings":"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","file":"static/js/52.432cc0da.chunk.js","sourcesContent":["import gql from \"graphql-tag\"\n\nexport const MUTATE_ADD_CHAT_SESSION = gql`\n\tmutation MUTATE_ADD_CHAT_SESSION($receiver_id: Int!) {\n\t\taddChatRoom(receiver_id: $receiver_id) {\n\t\t\ttext\n\t\t\tsuccess\n\t\t\tchatParentId\n\t\t}\n\t}\n`\n\nexport const QUERY_LIST_CHAT_ROOM = gql`\n\tquery QUERY_LIST_CHAT_ROOM($roleUser: Int!) {\n\t\tlistChatRoom(roleUser: $roleUser) {\n\t\t\tchatRoomPvid\n\t\t\tuserPvid\n\t\t\tfirstName\n\t\t\tlastName\n\t\t\tresource {\n\t\t\t\tpath\n\t\t\t}\n\t\t\tcreatedAt\n\t\t}\n\t}\n`\n\nexport const QUERY_LIST_CONVERSATION = gql`\n\tquery QUERY_LIST_CONVERSATION($receiverId: Int!) {\n\t\tconversationList(receiverId: $receiverId) {\n\t\t\tchatRoomPvid\n\t\t\tconversations {\n\t\t\t\tuserPvid\n\t\t\t\tname\n\t\t\t\tmessage\n\t\t\t\tcreatedAt\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const MUTATE_ADD_CONVERSATION = gql`\n\tmutation MUTATE_ADD_CONVERSATION(\n\t\t$chatRoomPvid: Int!\n\t\t$message: String!\n\t\t$senderName: String!\n\t\t$isFirstTime: Boolean!\n\t\t$studyCenterPvid: Int\n\t) {\n\t\taddConversation(\n\t\t\tchatRoomPvid: $chatRoomPvid\n\t\t\tmessage: $message\n\t\t\tsenderName: $senderName\n\t\t\tisFirstTime: $isFirstTime\n\t\t\tstudyCenterPvid: $studyCenterPvid\n\t\t) {\n\t\t\tchatRoomPvid\n\t\t\tname\n\t\t\tmessage\n\t\t\tcreatedAt\n\t\t\tuserPvid\n\t\t}\n\t}\n`\n","import React from \"react\"\nimport styled from \"styled-components\"\nimport { Card, Button, ButtonLink, Loading, Booking } from \"components\"\n// import avatar from \"assets/images/avatar.png\"\nimport Cropper from \"react-easy-crop\"\nimport { useMutation, useQuery } from \"react-apollo\"\nimport { mutateUploadProfilePicture } from \"queries/profile\"\nimport { client, renderError, PLACEHOLDER_OWL_IMAGE, newClient } from \"helpers\"\n// import useError from \"helpers/hooks/useError\"\nimport { message } from \"antd\"\nimport { Trans, t } from \"@lingui/macro\"\nimport { withI18n } from \"@lingui/react\"\nimport { MUTATE_ADD_CHAT_SESSION, QUERY_LIST_CONVERSATION } from \"queries/chat\"\nimport { useState } from \"react\"\nimport { useHistory } from \"react-router\"\nimport { country } from \"App\"\nimport { SERVER_BASE_URL } from \"helpers/constants\"\n\n/**\n * TODO:\n * - Crop handler upon upload avatar (with canvas)\n * -\n */\n\nconst ProfileCard = styled(Card)`\n\tposition: relative;\n\t.change-picture {\n\t\tdisplay: none;\n\t\tposition: absolute;\n\t\ttop: 45%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t}\n\t.ant-card-cover {\n\t\tbackground-color: #f3f3f3;\n\t\theight: 240px;\n\t\tmax-height: 300px;\n\t\toverflow: hidden;\n\t\twidth: 100%;\n\t\tborder-radius: 8px 8px 0 0;\n\t\t> img {\n\t\t\theight: 100%;\n\t\t\tobject-fit: cover;\n\t\t}\n\t}\n\t.ant-card-body {\n\t\tpadding: 2.5em 1.5em;\n\t\ttext-align: center;\n\t\t.ant-card-meta-detail {\n\t\t\t.ant-card-meta-title {\n\t\t\t\tfont-weight: 700;\n\t\t\t}\n\t\t}\n\t}\n\t&:hover {\n\t\t.upload-zone {\n\t\t\topacity: 1;\n\t\t\tvisibility: visible;\n\t\t}\n\t}\n`\n\nconst UploadButtons = styled.span`\n\tposition: absolute;\n\tbottom: -10%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n`\n\nconst UploadZone = styled.span`\n\twidth: 100%;\n\topacity: 0;\n\tvisibility: hidden;\n\tposition: absolute;\n\ttop: 45%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n\tinput[type=\"file\"] {\n\t\twidth: 0.1px;\n\t\theight: 0.1px;\n\t\topacity: 0;\n\t\toverflow: hidden;\n\t\tz-index: -1;\n\t\t+ label {\n\t\t\tbackground: #fff;\n\t\t\tcursor: pointer;\n\t\t\tpadding: 10px;\n\t\t\tborder-radius: 5px;\n\t\t\ttransition: all 0.3s ease;\n\t\t\tspan {\n\t\t\t\tfont-size: 1.2em;\n\t\t\t}\n\t\t\t&:hover {\n\t\t\t\tbox-shadow: 1px 3px 9px rgba(0, 0, 0, 0.25);\n\t\t\t}\n\t\t}\n\t}\n`\n\nconst UploadArea = styled.div`\n\t/* height: 200px; */\n\twidth: 100%;\n`\n\nconst ShareButton = styled(ButtonLink)`\n\t&& {\n\t\ttext-align: center;\n\t\tdisplay: block;\n\t\toverflow-x: hidden;\n\t\tmax-width: 200px;\n\t\ttext-overflow: ellipsis;\n\t\tmargin: 0 auto;\n\t}\n`\n\nconst chatClient = newClient(\"chat\")\n\nfunction AvatarCard({\n\tdata,\n\tunauthorizedUser,\n\tonShareModal,\n\ti18n,\n\tonChatWindow,\n\tonUploadImage,\n\tloading,\n\tonSettings,\n\tonLocalFile,\n\tfetchUser,\n\t...props\n}) {\n\tconst { userData = {}, theTotal, userDetails, teachingDate } = data\n\tconst { localFile, setLocalFile } = onLocalFile\n\tconst { shareModal, setShareModal } = onShareModal\n\tconst { pictureSettings, setPictureSettings } = onSettings\n\tconst { chatWindow, setChatWindow } = onChatWindow\n\tconst [conversationList, setConversationList] = useState([])\n\tconst [showBooking, setShowBooking] = useState(false)\n\tconst [editMode, setEditMode] = useState(\"schedule\")\n\tconst token = localStorage.getItem(\"token\")\n\n\tconst { push } = useHistory()\n\t// TODO:\n\t// const [isEditing, setIsEditing] = useState(false)\n\t// const [zoom, setZoom] = useState(pictureSettings.zoom)\n\t// const [croppedPixels, setCroppedPixels] = useState({})\n\n\tconst [uploadAvatar] = useMutation(mutateUploadProfilePicture, {\n\t\tclient: client.resourceClient,\n\t\tonCompleted: (data) => setLocalFile({}),\n\t\tonError: (err) => renderError(err)\n\t})\n\n\tconst [addChatSession] = useMutation(MUTATE_ADD_CHAT_SESSION, {\n\t\tclient: chatClient,\n\t\t// onCompleted: data => console.log({ chatSession: data }),\n\t\tvariables: { receiver_id: Number(userData.pvid) }\n\t})\n\n\tuseQuery(QUERY_LIST_CONVERSATION, {\n\t\tclient: chatClient,\n\t\tvariables: { receiverId: Number(userData.pvid) },\n\t\tonCompleted: (data) => {\n\t\t\tdata = data.conversationList.conversations\n\t\t\tsetConversationList(data)\n\t\t}\n\t})\n\n\tconst avatarData = userData.avatar || []\n\tconst address = userData.address ? (\n\t\t<a href={`https://www.google.com/maps/dir/?api=1&destination=${userData.address}`} target=\"_blank\" rel=\"noreferrer noopener\">\n\t\t\t{userData.address} &nbsp; &#8599;\n\t\t</a>\n\t) : (\n\t\t<Trans>No location specified</Trans>\n\t)\n\n\tconst totalExperience =\n\t\ttheTotal === \"0.0\" || theTotal === 0 ? <Trans>No experience yet</Trans> : <Trans>{parseFloat(theTotal)}y exp</Trans>\n\n\t// prettier-ignore\n\tconst infoDetail = (\n        <span className=\"info-detail\">\n            <p css={` margin-bottom: 0; `}>\n                {address}\n            </p>{\" \"}\n            {totalExperience}\n        </span>\n    )\n\n\tconst handleCrop = (crop) => setPictureSettings((prev) => ({ ...prev, crop }))\n\n\tconst handleZoom = (zoom) => setPictureSettings((prev) => ({ ...prev, zoom }))\n\n\tconst handleCropComplete = (area, pixels) => {\n\t\t// TODO:\n\t\t// const canvas = document.createElement(\"canvas\")\n\t\t// const ctx = canvas.getContext(\"2d\")\n\t\t// const image = document.querySelector(\"#avatar\")\n\t\t// canvas.setAttribute(\"width\", pixels.width)\n\t\t// canvas.setAttribute(\"height\", pixels.height)\n\t\t// ctx.drawImage(\n\t\t//     image,\n\t\t//     pixels.x,\n\t\t//     pixels.y,\n\t\t//     pixels.width,\n\t\t//     pixels.height,\n\t\t//     0,\n\t\t//     0,\n\t\t//     pixels.width,\n\t\t//     pixels.height\n\t\t// )\n\t\t// setCroppedPixels(pixels)\n\t}\n\n\tconst handleUpload = () => {\n\t\tuploadAvatar({ variables: { file: localFile.file } }).then(() => {\n\t\t\tmessage.loading(i18n._(t`Please wait...`)).then(() => fetchUser())\n\t\t})\n\t}\n\n\tconst handleAddChatSession = () => {\n\t\tif (!token) push(`/${country}/login`)\n\t\telse push({ pathname: `/${country}/chats`, state: { userData } })\n\t}\n\n\tconst src = localFile.actual ? SERVER_BASE_URL + localFile.actual : localFile.imagePreview || \"\"\n\tconst avatarSrc = avatarData.length > 0 ? src : SERVER_BASE_URL + PLACEHOLDER_OWL_IMAGE\n\n\tif (loading)\n\t\treturn (\n\t\t\t<Card>\n\t\t\t\t<Loading />\n\t\t\t</Card>\n\t\t)\n\n\treturn (\n\t\t<ProfileCard\n\t\t\theight=\"auto\"\n\t\t\tsrc={avatarSrc}\n\t\t\ttitle={`${userData.firstName} ${userData.initialName || \"\"}`}\n\t\t\tdescription={infoDetail}\n\t\t\tid=\"avatar\"\n\t\t>\n\t\t\t{!unauthorizedUser && (\n\t\t\t\t<UploadArea>\n\t\t\t\t\t{localFile.file && localFile.imagePreview ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Cropper\n\t\t\t\t\t\t\t\timage={localFile.imagePreview}\n\t\t\t\t\t\t\t\tcrop={pictureSettings.crop}\n\t\t\t\t\t\t\t\tzoom={pictureSettings.zoom}\n\t\t\t\t\t\t\t\taspect={pictureSettings.aspect}\n\t\t\t\t\t\t\t\tonCropChange={handleCrop}\n\t\t\t\t\t\t\t\tonCropComplete={handleCropComplete}\n\t\t\t\t\t\t\t\tonZoomChange={handleZoom}\n\t\t\t\t\t\t\t\t// onImageLoaded={imageSize => setZoom(300 / imageSize.naturalHeight)}\n\t\t\t\t\t\t\t\trestrictPosition={false}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UploadButtons className=\"upload-buttons\">\n\t\t\t\t\t\t\t\t<Button type=\"primary\" icon=\"image\" onClick={handleUpload}>\n\t\t\t\t\t\t\t\t\t<Trans>Upload profile picture</Trans>\n\t\t\t\t\t\t\t\t</Button>{\" \"}\n\t\t\t\t\t\t\t\t&nbsp;{\" \"}\n\t\t\t\t\t\t\t\t<ButtonLink size=\"large\" onClick={() => setLocalFile(\"\")}>\n\t\t\t\t\t\t\t\t\t<Trans>Cancel</Trans>\n\t\t\t\t\t\t\t\t</ButtonLink>\n\t\t\t\t\t\t\t</UploadButtons>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<UploadZone className=\"upload-zone\" onClick={() => setLocalFile((prev) => ({ ...prev, isAvatar: true }))}>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\t\tname=\"picture\"\n\t\t\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\t\t\tid=\"picture\"\n\t\t\t\t\t\t\t\tplaceholder={i18n._(t`Upload...`)}\n\t\t\t\t\t\t\t\tonChange={onUploadImage}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label htmlFor=\"picture\">\n\t\t\t\t\t\t\t\t<span role=\"img\" aria-label=\"cowboy\">\n\t\t\t\t\t\t\t\t\t🤠\n\t\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\t\t<Trans>Change profile picture</Trans>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</UploadZone>\n\t\t\t\t\t)}\n\t\t\t\t</UploadArea>\n\t\t\t)}\n\t\t\t{userDetails.token && userDetails.role.code === \"STDN\" && (\n\t\t\t\t<Booking\n\t\t\t\t\tuserData={userData}\n\t\t\t\t\tuserDetails={userDetails}\n\t\t\t\t\tfetchUser={fetchUser}\n\t\t\t\t\tunauthorizedUser={unauthorizedUser}\n\t\t\t\t\tteachingDate={teachingDate}\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t{!localFile.file && !localFile.imagePreview && (\n\t\t\t\t<>\n\t\t\t\t\t{/* <Tooltip title={<Trans>This feature will be available soon</Trans>}> */}\n\t\t\t\t\t<Button type=\"primary\" icon=\"mail\" onClick={handleAddChatSession} style={{ marginBottom: \"1em\" }}>\n\t\t\t\t\t\t&nbsp; <Trans>Send message</Trans>\n\t\t\t\t\t</Button>\n\t\t\t\t\t{/* </Tooltip> */}\n\t\t\t\t\t<ShareButton icon=\"share-alt\" onClick={() => setShareModal(true)}>\n\t\t\t\t\t\t&nbsp; <Trans>Share {userData.firstName}'s profile</Trans>\n\t\t\t\t\t</ShareButton>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</ProfileCard>\n\t)\n}\n\nexport default withI18n()(AvatarCard)\n"],"sourceRoot":""}
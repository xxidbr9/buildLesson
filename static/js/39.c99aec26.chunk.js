(this.webpackJsonpcudysg=this.webpackJsonpcudysg||[]).push([[39],{1415:function(t,e,a){"use strict";a.d(e,"a",(function(){return l})),a.d(e,"c",(function(){return u})),a.d(e,"d",(function(){return d})),a.d(e,"b",(function(){return f}));var n=a(5),r=a(70),c=a.n(r);function o(){var t=Object(n.a)(["\n\tmutation MUTATE_ADD_CONVERSATION(\n\t\t$chatRoomPvid: Int!\n\t\t$message: String!\n\t\t$senderName: String!\n\t\t$isFirstTime: Boolean!\n\t\t$studyCenterPvid: Int\n\t) {\n\t\taddConversation(\n\t\t\tchatRoomPvid: $chatRoomPvid\n\t\t\tmessage: $message\n\t\t\tsenderName: $senderName\n\t\t\tisFirstTime: $isFirstTime\n\t\t\tstudyCenterPvid: $studyCenterPvid\n\t\t) {\n\t\t\tchatRoomPvid\n\t\t\tname\n\t\t\tmessage\n\t\t\tcreatedAt\n\t\t\tuserPvid\n\t\t}\n\t}\n"]);return o=function(){return t},t}function i(){var t=Object(n.a)(["\n\tquery QUERY_LIST_CONVERSATION($receiverId: Int!) {\n\t\tconversationList(receiverId: $receiverId) {\n\t\t\tchatRoomPvid\n\t\t\tconversations {\n\t\t\t\tuserPvid\n\t\t\t\tname\n\t\t\t\tmessage\n\t\t\t\tcreatedAt\n\t\t\t}\n\t\t}\n\t}\n"]);return i=function(){return t},t}function s(){var t=Object(n.a)(["\n\tquery QUERY_LIST_CHAT_ROOM($roleUser: Int!) {\n\t\tlistChatRoom(roleUser: $roleUser) {\n\t\t\tchatRoomPvid\n\t\t\tuserPvid\n\t\t\tfirstName\n\t\t\tlastName\n\t\t\tresource {\n\t\t\t\tpath\n\t\t\t}\n\t\t\tcreatedAt\n\t\t}\n\t}\n"]);return s=function(){return t},t}function m(){var t=Object(n.a)(["\n\tmutation MUTATE_ADD_CHAT_SESSION($receiver_id: Int!) {\n\t\taddChatRoom(receiver_id: $receiver_id) {\n\t\t\ttext\n\t\t\tsuccess\n\t\t\tchatParentId\n\t\t}\n\t}\n"]);return m=function(){return t},t}var l=c()(m()),u=c()(s()),d=c()(i()),f=c()(o())},1416:function(t,e,a){"use strict";a.d(e,"a",(function(){return v}));a(97);var n=a(25),r=(a(121),a(35)),c=(a(91),a(37)),o=a(5),i=a(0),s=a.n(i),m=a(162),l=a(15),u=a(38),d=a.n(u),f=a(46);function h(){var t=Object(o.a)(["\n\t.ant-card {\n\t\tmargin-bottom: 1em;\n\t\tmax-width: ",";\n\t\tfloat: ",";\n\t\tbox-shadow: none;\n\t\t/* box-shadow: ","; */\n\t\t.ant-card-body {\n\t\t\tmargin-bottom: 0;\n\t\t\tpadding: 1em;\n\t\t\tfont-size: 1em;\n\t\t\tborder-radius: 8px;\n\t\t\tbackground: ",";\n\t\t}\n\t}\n"]);return h=function(){return t},t}var b=Object(l.b)(c.a)(h(),(function(t){return t.isChatPage?"85%":"75%"}),(function(t){return"me"===t.sender?"right":"left"}),f.a.boxShadow.hover,(function(t){return"me"===t.sender?"rgba(0, 55, 255, 0.16)":f.a.lightGrey.one}));function v(t){var e=t.data,a=t.isChatPage,c=e.sender,o=d()(e.time).format("DD MM YYYY")===d()().format("DD MM YYYY")?d()().format("HH:mm"):d()(e.time).format("DD MMM - HH:mm");return s.a.createElement(b,{sender:c,isChatPage:a},s.a.createElement(n.a,{lg:24},s.a.createElement(m.a,{autoHeight:!0,noHover:!0,className:"me"===c?"ta-right":"ta-left"},s.a.createElement(r.a.Paragraph,null,e.message),s.a.createElement(r.a.Text,{className:"light-grey"},o))))}},1696:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return Y}));a(210);var n=a(83),r=(a(677),a(1408)),c=(a(91),a(37)),o=(a(97),a(25)),i=(a(214),a(124)),s=(a(304),a(82)),m=a(157),l=a(19),u=a(28),d=(a(417),a(111)),f=a(15),h=a(0),b=a.n(h),v=a(42),g=a(55),p=a(1415),N=a(16),E=a(38),O=a.n(E),j=a(46),P=a(1416),C=a(1354),y=a.n(C),S=a(32),R=a(80),_=a(45),I=a(131),T=a(27),k=a(1667),w=(a(1631),a(48)),x=Object(N.k)("chat"),$=Object(N.k)(),A=Object(f.b)(I.a).withConfig({displayName:"Chats__StyledTextInput",componentId:"sc-76svk8-0"})(["input.ant-input{height:42px;border-radius:8px;border:none;}"]),M=Object(f.b)(d.a.Item).withConfig({displayName:"Chats__ListItem",componentId:"sc-76svk8-1"})(["cursor:pointer;.ant-list-item-meta{.ant-list-item-meta-content{text-align:left;}}.datetime{color:",";}&:hover{background-color:",";}"],j.a.greyColor,j.a.primaryColorRgba),D=f.b.div.withConfig({displayName:"Chats__SendInput",componentId:"sc-76svk8-2"})(["position:sticky;bottom:0;left:0;.ant-form{padding:2em 0;background-color:#f0f2f5;.ant-form-explain{display:none;}}"]),H=f.b.section.withConfig({displayName:"Chats__ChatContentSection",componentId:"sc-76svk8-3"})(["height:80vh;overflow-y:scroll;"]);function Y(){var t=Object(h.useState)([]),e=Object(u.a)(t,2),a=e[0],f=e[1],N=Object(h.useState)({}),E=Object(u.a)(N,2),j=E[0],C=E[1],I=Object(h.useState)([]),Y=Object(u.a)(I,2),U=Y[0],L=Y[1],F=Object(h.useState)(!1),V=Object(u.a)(F,2),z=(V[0],V[1]),J=Object(h.useState)(""),q=Object(u.a)(J,2),B=q[0],Q=q[1],G=Object(h.useState)({}),K=Object(u.a)(G,2),W=K[0],X=K[1],Z=Object(T.h)(),tt=Z.state,et=void 0===tt?{}:tt,at=(Z.search,Object(T.g)().push),nt=localStorage.getItem("token"),rt=et.userData||{},ct=Object(g.b)(R.l,{client:$,onCompleted:function(t){t=t.getProfile||{},X(t)}}),ot=Object(u.a)(ct,1)[0],it=Object(h.useContext)(S.b),st=it.socket,mt=(it.onNewMessage,JSON.parse(localStorage.getItem("userDetails"))||{}),lt=Number(mt.pvid),ut=Object(h.useRef)(null);Object(g.c)(p.c,{client:x,variables:{roleUser:Number((mt.role||{}).pvid)},onCompleted:function(t){t=t.listChatRoom,f(t)}}),Object(g.c)(p.d,{client:x,variables:{receiverId:Number(j.userPvid)},onCompleted:function(t){t=t.conversationList||{},L(t.conversations),C((function(e){return Object(l.a)({},e,{chatRoomPvid:t.chatRoomPvid})}))}});var dt=Object(g.b)(p.b,{client:x,onCompleted:function(t){t=t.addConversation||{},st.emit("new_message",{chatRoomPvid:Number(j.chatRoomPvid),name:W.firstName+" "+W.lastName,message:t.message,userPvid:lt})}}),ft=Object(u.a)(dt,1)[0],ht=function(t){st.emit("typing_in_chat_room",{chatRoomPvid:Number(j.chatRoomPvid),firstName:W.firstName,lastName:W.lastName})};return Object(h.useEffect)((function(){nt||at("/".concat(S.d,"/login")),ut.current&&j.firstName&&ut.current.scrollTo(0,ut.current.scrollHeight)}),[at,j.firstName,nt]),Object(h.useEffect)((function(){Object.keys(rt).length>0&&C({userPvid:rt.pvid,firstName:rt.firstName,lastName:rt.lastName,resource:{path:rt.avatar[rt.avatar.length-1].path}}),st.on("new_message",(function(t){console.log({newMessage:t}),L((function(e){return[].concat(Object(m.a)(e),[Object(l.a)({},t,{chatRoomPvid:Number(t.chatRoomPvid),userPvid:Number(t.userPvid)})])})),ut.current&&ut.current.scrollTo(0,ut.current.scrollHeight)})),ot()}),[st]),b.a.createElement(v.n,null,b.a.createElement(v.u,{className:"p2em"},b.a.createElement(c.a,{gutter:64,type:"flex",justify:"center"},b.a.createElement(o.a,{lg:6,className:"ta-center border-right"},b.a.createElement(s.a.Search,{value:B,onChange:function(t){var e=a.filter((function(e){return(e.firstName+" "+e.lastName).toLowerCase()===t}));Q(t),f(e)},name:"search",placeholder:"Search the chats...",className:"mb2em"}),b.a.createElement(d.a,{itemLayout:"horizontal",dataSource:a,locale:{emptyText:b.a.createElement(v.j,{description:"No chat found"})},renderItem:function(t){return b.a.createElement(M,{onClick:function(){return function(t){C(t),ut.current&&ut.current.scrollTo(0,ut.current.scrollHeight),st.emit("join_chat_room",{chatRoomPvid:t.chatRoomPvid})}(t)}},b.a.createElement(d.a.Item.Meta,{title:t.firstName+" "+t.lastName,avatar:b.a.createElement(i.a,{src:w.f+t.resource.path})}),b.a.createElement("div",{className:"datetime"},O()(t.createdAt).fromNow()))}})),b.a.createElement(o.a,{lg:14},b.a.createElement(c.a,{type:"flex",align:"middle",className:"mb1em"},j.firstName&&b.a.createElement(o.a,{lg:2},b.a.createElement(i.a,{size:"large",src:w.f+(j.resource||{}).path})),b.a.createElement(o.a,{lg:10},b.a.createElement(v.l,{level:4,marginBottom:"0",content:j.firstName?j.firstName+" "+j.lastName:"Select person to chat"}))),b.a.createElement(H,{ref:ut},0===U.length?b.a.createElement(v.j,{description:j.firstName?b.a.createElement("span",null,"Start chatting with ",b.a.createElement("strong",null,j.firstName)):"No chat found"}):U.map((function(t){return b.a.createElement(y.a,{key:t.createdAt},b.a.createElement(P.a,{key:t.createdAt,isChatPage:!0,data:Object(l.a)({},t,{time:t.createdAt,sender:t.userPvid===lt?"me":"them"})}))}))),j.firstName&&b.a.createElement(D,null,b.a.createElement(_.b,{initialValues:{message:"",senderName:W.firstName+" "+W.lastName,sender:"me",isFirstTime:!1},onSubmit:function(t,e){var a=e.setSubmitting,n=e.resetForm;z(!0),t=Object(l.a)({},t,{chatRoomPvid:Number(j.chatRoomPvid)}),ft({variables:t}).finally((function(){a(!1),n({})}))}},(function(t){var e=t.handleSubmit,a=t.setFieldValue,i=t.values;return b.a.createElement(n.a,{layout:"vertical",onSubmit:e},b.a.createElement(c.a,{gutter:16},b.a.createElement(o.a,{lg:20},b.a.createElement(A,{name:"message",placeholder:"Type your message...",mb:"0",onKeyUp:ht})),b.a.createElement(o.a,{lg:4},b.a.createElement(r.a,{title:"Emoji",trigger:"click",content:b.a.createElement(k.a,{set:"apple",onSelect:function(t){return a("message",i.message+t.native)}})},b.a.createElement(v.d,{type:"default"},b.a.createElement("span",{role:"img","aria-label":"Smile"},"\ud83d\ude04"))))))})))))))}}}]);
//# sourceMappingURL=39.c99aec26.chunk.js.map